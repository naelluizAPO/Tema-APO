{%- if sidebar_type == 'vertical' -%}
    {%- for block in section.blocks -%}
        {%- if block.type == 'category' -%}
            {% render 'halo-side-all-categories',
                block: block,
                show_collapse: show_collapse,
                sidebar_collapse: sidebar_collapse
            %}
        {%- endif -%}
    {%- endfor -%}
{%- endif -%}
{%- if show_filter -%}
    {%- assign file_extension = 'png' -%}
    {{ 'component-filter.css' | asset_url | stylesheet_tag }}
    <div class="collection-filters" id="main-collection-filters" data-id="{{ section.id }}">
        {%- if filter_type == 'storefront' -%}
            <script type="text/javascript">
                window.show_storefront_filter = true;
            </script>
            {%- liquid
                if results.url
                    assign results_url = results.url
                else
                    assign terms = results.terms | escape
                    assign results_url = '?q=' | append: terms | append: '&type=product&sort_by=' | append: sort_by
                endif
                assign total_active_values = 0
                for filter in results.filters
                    for value in filter.active_values
                        assign total_active_values = total_active_values | plus: 1
                    endfor
                endfor
            -%}
            <collection-filters-form class="facets facets-{{ sidebar_type }} filter-display-{{ section.settings.filter_display_type }}" data-filter-display="{{ section.settings.filter_display_type }}">
                <form id="CollectionFiltersForm" class="facets__form">
                    {%- if results.terms -%}
                        <input type="hidden" name="q" value="{{ results.terms | escape }}">
                        <input type="hidden" name="type" value="product">
                        <input type="hidden" name="options[prefix]" value="last" />
                    {%- endif -%}
                    <div class="sidebarBlock refined-widgets js-filter" {% if total_active_values == 0 %} style="display: none;"{% endif %} data-index="0">
                        <h3 class="sidebarBlock-heading">
                            <span class="facets__text">{{ 'sections.collection_template.refined_by' | t }}</span>
                            <a href="{{ results_url }}" class="active-facets__button facets__clear-all link link-underline js-facet-remove">
                                <span class="text">
                                    {{ 'sections.collection_template.clear_all' | t }}
                                </span>
                            </a>
                        </h3>
                        <div class="results-count"><span class="results" style="display: none;"><span class="count">{{ collection.products_count }}</span> {{ 'sections.collection_template.results' | t }}</span></div>
                        <div class="sidebarBlock-content sidebarBlock-content--list">
                            <a href="{{ results_url }}" class="active-facets__button facets__clear-all link link-underline js-facet-remove">
                                <span class="text">
                                    {{ 'sections.collection_template.clear_all' | t }}
                                </span>
                            </a>
                            <ul class="facets__list--refined list-unstyled" role="list">
                                {%- for filter in results.filters -%}
                                    {%- for value in filter.active_values -%}
                                        <li>
                                            <facet-remove>
                                                <a class="active-facets__button js-facet-remove" href="{{ value.url_to_remove }}">
                                                    <span class="text">
                                                        {{ value.label | escape }}
                                                    </span>
                                                    <span class="close"></span>
                                                </a>
                                            </facet-remove>
                                        </li>
                                    {%- endfor -%}
                                    {%- if filter.type == "price_range" -%}
                                        {%- if filter.min_value.value != nil or filter.max_value.value != nil -%}
                                            <li>
                                                <facet-remove>
                                                    <a class="active-facets__button js-facet-remove" href="{{ filter.url_to_remove }}">
                                                        <span class="text">
                                                            {%- if filter.min_value.value -%}
                                                                {{ filter.min_value.value | money }}{% else %}{{ 0 | money }}
                                                            {%- endif -%}
                                                            <span class="separate"> - </span>
                                                            {%- if filter.max_value.value -%}
                                                                {{ filter.max_value.value | money }}{% else %}{{ filter.range_max | money }}
                                                            {%- endif -%}
                                                        </span>
                                                        <span class="close"></span>
                                                    </a>
                                                </facet-remove>
                                            </li>
                                        {%- endif -%}
                                    {%- endif -%}
                                {%- endfor -%}
                            </ul>
                        </div>                  
                    </div>
                    {%- if results.current_vendor or results.current_type -%}
                        <input type="hidden" name="q" value="{{ results.current_vendor }}{{ results.current_type }}">
                    {%- endif -%}
                    <div class="collection-filters__item facets__wrapper">
                        {%- if sidebar_type == 'horizontal' -%}
                            <div class="widget_filter" style="display: none;">
                                <span class="icon-filter1">
                                    {% render 'icon-filter-2' %}
                                </span>
                                <span class="sidebar_more">
                                  {{ 'sections.collection_template.refined_by' | t }}
                                </span>
                            </div> 
                        {%- endif -%}
                        {%- for filter in results.filters -%}
                            {%- assign total_active_values = total_active_values | plus: filter.active_values.size -%}
                            {%- case filter.type -%}
                                {%- when 'list' -%}
                                    <div class="sidebarBlock js-filter" data-index="{{ forloop.index }}" data-type-list="true">
                                        {%- if show_collapse -%}
                                            <div class="sidebarBlock-headingWrapper">
                                        {%- endif -%}
                                            <h3 class="sidebarBlock-heading{% if show_collapse %}{% if sidebar_collapse == 'expand' %} is-clicked{% endif %}{% endif %}">
                                                <span class="facets__text">{{ filter.label | escape }}</span>
                                                <span class="facets__count{% if sidebar_type == 'horizontal' %}{% if filter.active_values.size > 0 %} custom-count{% endif %}{% endif %}" aria-hidden="true">{%- if sidebar_type == 'horizontal' -%}{%- if filter.active_values.size > 0 -%}<span>{{ filter.active_values.size }}</span>{%- endif -%}{% elsif sidebar_type == 'vertical' %}{%- if filter.active_values.size > 0 -%}({{ filter.active_values.size }}){%- endif -%}{%- endif -%}</span>
                                            </h3>
                                        {%- if show_collapse -%}
                                            </div>
                                            <div class="sidebarBlock-contentWrapper" {% if sidebar_collapse == 'expand' %} style="display: block;"{% endif %}>
                                        {%- endif -%}
                                            <div class="sidebarBlock-content sidebarBlock-content--full facets__display">
                                                <ul class="facets__list custom-scrollbar list-unstyled" role="list" data-max-items="{{ section.settings.max_item_per_filter }}">
                                                    {%- liquid
                                                        assign label = filter.label | downcase | handle
                                                        assign filter_swatch = filter_swatch | split: "," | strip | downcase | handle
                                                        assign filter_rectangle = filter_rectangle | split: "," | strip | downcase | handle
                                                    -%}
                                                    {%- for value in filter.values -%}
                                                        <li class="list-menu__item facets__item {% if forloop.index > section.settings.max_item_per_filter and section.settings.filter_display_type == 'show-more' %}d-none{% endif %}{% if filter_swatch contains label %} facets__item--swatch{% elsif filter_rectangle contains label %} facets__item--rectangle{% endif %}">
                                                            <input
                                                                type="checkbox"
                                                                name="{{ value.param_name }}"
                                                                value="{{ value.value }}"
                                                                id="Filter-{{ filter.label | escape }}-{{ forloop.index }}"
                                                                {% if value.active %}checked{% endif %}
                                                                {% if value.count == 0 and value.active == false %}disabled{% endif %}
                                                            >
                                                            {%- if filter_swatch contains label -%}
                                                                <label
                                                                    for="Filter-{{ filter.label | escape }}-{{ forloop.index }}"
                                                                    class="facet-checkbox{% if value.count == 0 and value.active == false %} facet-checkbox--disabled{% endif %}"
                                                                    title="{{ value.label | escape }}"
                                                                >
                                                                    <span class="pattern{% if value.value == 'white' or value.value == 'White' %} pattern--white{% endif %}" 
                                                                        style="{%- if filter_swatch_type == 'png' %}
                                                                                background-color: {{ value.value | split: ' ' | last | handle }};
                                                                                background-image: url({{ value.value | strip | handleize | handle | append: '.' | append: file_extension | file_url }})
                                                                                {% else %}
                                                                                 background-color: {{ value.value | split: ' ' | last | handle }};
                                                                                {% endif %}">
                                                                    </span>
                                                                    <span class="visually-hidden">{{ value.label | escape }}</span>
                                                                </label>
                                                            {%- elsif filter_rectangle contains label -%}
                                                                <label
                                                                    for="Filter-{{ filter.label | escape }}-{{ forloop.index }}"
                                                                    class="facet-checkbox{% if value.count == 0 and value.active == false %} facet-checkbox--disabled{% endif %}">
                                                                    <span class="text">{{ value.label | escape }}</span>
                                                                </label>
                                                            {%- else -%}
                                                                <label
                                                                    for="Filter-{{ filter.label | escape }}-{{ forloop.index }}"
                                                                    class="facet-checkbox{% if value.count == 0 and value.active == false %} facet-checkbox--disabled{% endif %} form-label--checkbox">
                                                                    {{ value.label | escape }}
                                                                    <span class="count">({{ value.count }})</span>
                                                                </label>
                                                            {%- endif -%}
                                                        </li>
                                                    {%- endfor -%}
                                                </ul>
                                                <a href="{{ filter.url_to_remove }}" class="facets__reset link link-underline js-facet-remove" data-index="{{ forloop.index }}" {% if filter.active_values.size == 0 %} style="display: none;"{% endif %}>
                                                    <span class="text">{{ 'sections.collection_template.clear_all' | t }}</span>
                                                </a>
                                                {% if  sidebar_type == 'horizontal' %}
                                                    {% if section.settings.filter_display_type == 'show-more' %}
                                                        {% if filter.values.size > section.settings.max_item_per_filter %}
                                                            <div class="show-more--list_tags" data-show-more-btn="{{ filter.label | downcase }}">
                                                                <span class="icon-container">
                                                                    {% render 'icon-show-more' %}
                                                                </span>
                                                                <span class="btn-text"> 
                                                                    <span data-show-more-content>{{ 'sections.collection_template.show_all' | t }}</span>
                                                                </span>
                                                            </div>
                                                        {% endif %}
                                                    {% endif %}
                                                {% endif %}
                                            </div>
                                        {%- if show_collapse -%}
                                            </div>
                                        {%- endif -%}
                                        {% unless  sidebar_type == 'horizontal' %}
                                            {% if section.settings.filter_display_type == 'show-more' %}
                                                {% if filter.values.size > section.settings.max_item_per_filter %}
                                                    <div class="show-more--list_tags" data-show-more-btn="{{ filter.label | downcase }}">
                                                        <span class="icon-container">
                                                            {% render 'icon-show-more' %}
                                                        </span>
                                                        <span class="btn-text"> 
                                                            <span data-show-more-content>{{ 'sections.collection_template.show_all' | t }}</span>
                                                        </span>
                                                    </div>
                                                {% endif %}
                                            {% endif %}
                                        {% endunless %}
                                    </div>
                                {%- when 'price_range' -%}
                                    {% assign currencies_using_comma_decimals = "ANG,ARS,BRL,BYN,BYR,CLF,CLP,COP,CRC,CZK,DKK,EUR,HRK,HUF,IDR,ISK,MZN,NOK,PLN,RON,RUB,SEK,TRY,UYU,VES,VND" | split: ',' %}
                                    {% assign uses_comma_decimals = false %}
                                    {%- if currencies_using_comma_decimals contains cart.currency.iso_code -%}
                                        {% assign uses_comma_decimals = true %}
                                    {%- endif -%}
                                    <div class="sidebarBlock js-filter" data-index="{{ forloop.index }}" data-type-price="true">
                                        {%- if show_collapse -%}
                                            <div class="sidebarBlock-headingWrapper">
                                        {%- endif -%}
                                            <h3 class="sidebarBlock-heading{% if show_collapse %}{% if sidebar_collapse == 'expand' %} is-clicked{% endif %}{% endif %}">
                                                <span class="facets__text">{{ filter.label | escape }}</span>
                                                <span class="facets__count" aria-hidden="true">{%- if filter.active_values.size > 0 -%}({{ filter.active_values.size }}){%- endif -%}</span>
                                            </h3>
                                        {%- if show_collapse -%}
                                            </div>
                                            <div class="sidebarBlock-contentWrapper" {% if sidebar_collapse == 'expand' %} style="display: block;"{% endif %}>
                                        {%- endif -%}
                                            <div class="sidebarBlock-content sidebarBlock-content--full facets__display">
                                                <price-range class="facets__price">
                                                    <div class="facets__price--slider">
                                                        <div class="facets__price--slide">
                                                            <input
                                                                class="filter__price_change filter__price_min"
                                                                min="0"
                                                                max="{{ filter.range_max | money_without_currency | replace: ',', '' | replace: '.00', '' }}"
                                                                step="1"
                                                                type="range"
                                                                {%- if filter.min_value.value -%}
                                                                    {%- if uses_comma_decimals -%}
                                                                        value="{{ filter.min_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' | replace: '.00', '' }}"
                                                                    {%- else -%}
                                                                        value="{{ filter.min_value.value | money_without_currency | replace: ',', '' | replace: '.00', '' }}"
                                                                    {% endif %}
                                                                {%- else -%}
                                                                    value="0"
                                                                {%- endif -%}
                                                                aria-label="Min"
                                                            >
                                                            <input
                                                                class="filter__price_change filter__price_max"
                                                                min="0"
                                                                max="{{ filter.range_max | money_without_currency | replace: ',', '' | replace: '.00', '' }}"
                                                                step="1"
                                                                type="range"
                                                                {%- if filter.max_value.value -%}
                                                                    {%- if uses_comma_decimals -%}
                                                                        value="{{ filter.max_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' | replace: '.00', '' }}"
                                                                    {%- else -%}
                                                                        value="{{ filter.max_value.value | money_without_currency | replace: ',', '' | replace: '.00', '' }}"
                                                                    {% endif %}
                                                                {%- else -%}
                                                                    value="{{ filter.range_max | money_without_currency | replace: ',', '' | replace: '.00', '' }}"
                                                                {%- endif -%}
                                                                aria-label="Max"
                                                            >
                                                        </div>
                                                        <div class="facets__price--box price-slider clearfix">
                                                            <div class="form-field">
                                                                <span class="field__currency">{{ cart.currency.symbol }}</span>
                                                                <label class="form-label hiddenLabels" for="Filter-Min-{{ filter.label | escape }}-{{ forloop.index }}">
                                                                    {{ 'sections.collection_template.min' | t }}
                                                                </label>
                                                                <input
                                                                    class="form-input field__input filter__price"
                                                                    name="{{ filter.min_value.param_name }}"
                                                                    id="Filter-Min-{{ filter.label | escape }}-{{ forloop.index }}"
                                                                    {%- if filter.min_value.value -%}
                                                                        {%- if uses_comma_decimals -%}
                                                                            value="{{ filter.min_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' | replace: '.00', '' }}"
                                                                        {%- else -%}
                                                                            value="{{ filter.min_value.value | money_without_currency | replace: ',', '' | replace: '.00', '' }}"
                                                                        {% endif %}
                                                                    {%- endif -%}
                                                                    type="number"
                                                                    min="0"
                                                                    max="{{ filter.range_max | money_without_currency | replace: ',', '' | replace: '.00', '' }}"
                                                                    placeholder="0"
                                                                >
                                                            </div>
                                                            <span class="price-to-price">{{ 'sections.collection_template.to' | t }}</span>
                                                            <div class="form-field">
                                                                <span class="field__currency">{{ cart.currency.symbol }}</span>
                                                                <label class="form-label hiddenLabels" for="Filter-Max-{{ filter.label | escape }}-{{ forloop.index }}">
                                                                    {{ 'sections.collection_template.max' | t }}
                                                                </label>
                                                                <input
                                                                    class="form-input field__input filter__price"
                                                                    name="{{ filter.max_value.param_name }}"
                                                                    id="Filter-Max-{{ filter.label | escape }}-{{ forloop.index }}"
                                                                    {%- if filter.max_value.value -%}
                                                                        {%- if uses_comma_decimals -%}
                                                                            value="{{ filter.max_value.value | money_without_currency | replace: '.', '' | replace: ',', '.' | replace: '.00', '' }}"
                                                                        {%- else -%}
                                                                            value="{{ filter.max_value.value | money_without_currency | replace: ',', '' | replace: '.00', '' }}"
                                                                        {% endif %}
                                                                    {%- endif -%}
                                                                    type="number"
                                                                    min="0"
                                                                    max="{{ filter.range_max | money_without_currency | replace: ',', '' | replace: '.00', '' }}"
                                                                    placeholder="{{ filter.range_max | money_without_currency | replace: ',', '' | replace: '.00', '' }}"
                                                                >
                                                            </div>
                                                        </div>
                                                        <div class="form-actions">
                                                            <input class="button button--primary filter__price--apply" type="button" id="filter__price--apply" value="{{ 'sections.collection_template.apply' | t }}">
                                                        </div>
                                                    </div>
                                                </price-range>
                                            </div>
                                        {%- if show_collapse -%}
                                            </div>
                                        {%- endif -%}
                                    </div>
                            {%- endcase -%}
                        {%- endfor -%}
                        <noscript>
                            <button type="submit" class="facets__button button">
                                {{ 'sections.collection_template.filter_button' | t }}
                            </button>
                        </noscript>
                    </div>
                    {%- if show_sorting -%}
                        <div class="collection-filters__item sorting" style="display: none;">
                            <div class="collection-filters__field">
                                <label class="collection-filters__label" for="SortBy">
                                    {{ 'sections.collection_template.sort_by_label' | t }}
                                </label>
                                <div class="select">
                                    {%- assign sort_by = results.sort_by | default: results.default_sort_by -%}
                                    <select name="sort_by" class="select__select collection-filters__sort" id="SortBy" aria-describedby="a11y-refresh-page-message">
                                        {%- for option in results.sort_options -%}
                                            <option value="{{ option.value | escape }}"{% if option.value == sort_by %} selected="selected"{% endif %}>{{ option.name | escape }}</option>
                                        {%- endfor -%}
                                    </select>
                                    {% render 'icon-caret' %}
                                </div>
                            </div>
                            <noscript>
                                <button type="submit" class="button button--small">
                                    {{ 'sections.collection_template.sort_button' | t }}
                                </button>
                            </noscript>
                        </div>
                    {%- endif -%}
                </form>
            </collection-filters-form>
        {%- else -%}
            {%- liquid
                if current_tags == blank
                    assign has_refined = false
                else
                    assign has_refined = true
                endif
            -%}
            <script type="text/javascript">
                window.show_multiple_choice = {{ section.settings.show_multiple_choice }};
            </script>
            <collection-filters-form class="facets facets-{{ sidebar_type }} filter-display-{{ section.settings.filter_display_type }}" data-filter-display="{{ section.settings.filter_display_type }}">
                <form id="CollectionFiltersForm" class="facets__form">
                    {%- if has_refined -%}
                        <div class="sidebarBlock refined-widgets" data-index="0">
                            <h3 class="sidebarBlock-heading">
                                <span class="facets__text">{{ 'sections.collection_template.refined_by' | t }}</span>
                                <a href="{{ results.url }}" class="active-facets__button facets__clear-all link link-underline js-facet-remove" data-clear-all-filter>
                                    <span class="text">
                                        {{ 'sections.collection_template.clear_all' | t }}
                                    </span>
                                </a>
                            </h3>
                            <div class="sidebarBlock-content sidebarBlock-content--list">
                                <a href="{{ results_url }}" class="active-facets__button facets__clear-all link link-underline js-facet-remove">
                                    <span class="text">
                                        {{ 'sections.collection_template.clear_all' | t }}
                                    </span>
                                </a>
                                <ul class="facets__list--refined list-unstyled" role="list">
                                    {%- for tag in current_tags -%}
                                        {%- liquid
                                            assign item = tag | strip
                                            assign value = item | handleize
                                        -%}
                                        <li>
                                            <input
                                                type="checkbox"
                                                value="{{ value }}"
                                                id="Refined-{{ value }}-{{ forloop.index }}"
                                                name="Refined-{{ value }}-{{ forloop.index }}"
                                                {% if current_tags contains item %} checked{% endif %}
                                            >
                                            <label
                                                for="Refined-{{ value }}-{{ forloop.index }}"
                                                class="active-facets__button"
                                                title="{{ value }}"
                                            >
                                                <span class="text">
                                                    {{ item | split: '|' | first }}
                                                </span>
                                                <span class="close"></span>
                                            </label>
                                        </li>
                                    {%- endfor -%}
                                </ul>
                            </div>
                        </div>
                    {%- endif -%}
                    <div class="collection-filters__item facets__wrapper">
                        {%- for block in filter_by_tags -%}
                            {%- if block.settings.show_block -%}
                                {%- liquid
                                    assign title = block.settings.heading
                                    assign label = title | downcase | handle
                                    assign tags = block.settings.list_tags | split: ','
                                    assign filter_swatch = filter_swatch | split: "," | strip | downcase | handle
                                    assign filter_rectangle = filter_rectangle | split: "," | strip | downcase | handle
                                    assign count = 0
                                    if current_tags != ''
                                        for tag in tags
                                            assign item = tag | strip
                                            if current_tags contains item
                                                assign count = count | plus: 1
                                            endif
                                        endfor
                                    endif
                                -%}
                                <div class="sidebarBlock js-filter" data-index="{{ forloop.index }}" data-type-list="true">
                                    {%- if show_collapse -%}
                                        <div class="sidebarBlock-headingWrapper">
                                    {%- endif -%}
                                        <h3 class="sidebarBlock-heading{% if show_collapse %}{% if sidebar_collapse == 'expand' %} is-clicked{% endif %}{% endif %}">
                                            <span class="facets__text">
                                                {% if title != blank %}
                                                    {{ title | escape }}
                                                {% else %}
                                                    BLock Heading
                                                {% endif %}
                                            </span>
                                            <span class="facets__count" aria-hidden="true">{%- if count > 0 -%}({{ count }}){%- endif -%}</span>
                                        </h3>
                                    {%- if show_collapse -%}
                                        </div>
                                        <div class="sidebarBlock-contentWrapper" {% if sidebar_collapse == 'expand' %} style="display: block;"{% endif %}>
                                    {%- endif -%}
                                        <div class="sidebarBlock-content sidebarBlock-content--full facets__display">
                                            <ul class="facets__list custom-scrollbar list-unstyled" role="list" data-max-items="{{ section.settings.max_item_per_filter }}">
                                                {% assign loop_back = 0 %}
                                                {%- for tag in tags -%}
                                                    {%- liquid
                                                        assign item = tag | strip
                                                        assign value = item | handleize
                                                        assign valid_loop_index = forloop.index | minus: loop_back
                                                    -%}
                                                    {%- if current_tags contains item -%}
                                                        <li class="list-menu__item facets__item {{ valid_loop_index }} {% if valid_loop_index > section.settings.max_item_per_filter and section.settings.filter_display_type == 'show-more' %}d-none{% endif %}{% if filter_swatch contains label %} facets__item--swatch{% elsif filter_rectangle contains label %} facets__item--rectangle{% endif %}">
                                                            <input
                                                                type="checkbox"
                                                                value="{{ value | split: '|' | first }}"
                                                                name="Filter-{{ label | escape }}-{{ forloop.index }}"
                                                                id="Filter-{{ label | escape }}-{{ forloop.index }}"
                                                                checked
                                                            >
                                                            {%- if filter_swatch contains label -%}
                                                                <label
                                                                    for="Filter-{{ label | escape }}-{{ forloop.index }}"
                                                                    class="facet-checkbox"
                                                                    title="{{ item | split: '|' | first }}"
                                                                >
                                                                    <span class="pattern{% if value.value == 'white' or value.value == 'White' %} pattern--white{% endif %}" 
                                                                         style="{%- if filter_swatch_type == 'png' %}
                                                                                background-color: {{ value.value | split: ' ' | last | handle }};
                                                                                background-image: url({{ value.value | strip | handleize | handle | append: '.' | append: file_extension | file_url }})
                                                                                {% else %}
                                                                                 background-color: {{ value.value | split: ' ' | last | handle }};
                                                                                {% endif %}">
                                                                    </span>
                                                                </label>
                                                            {%- elsif filter_rectangle contains label -%}
                                                                <label
                                                                    for="Filter-{{ label | escape }}-{{ forloop.index }}"
                                                                    class="facet-checkbox"
                                                                    title="{{ item }}"
                                                                >
                                                                    <span class="text">{{ item | split: '|' | first }}</span>
                                                                </label>
                                                            {%- else -%}
                                                                <label
                                                                    for="Filter-{{ label | escape }}-{{ forloop.index }}"
                                                                    class="facet-checkbox form-label--checkbox"
                                                                    title="{{ item }}"
                                                                >
                                                                    {{ item | split: '|' | first }}
                                                                </label>
                                                            {%- endif -%}
                                                        </li>
                                                    {%- else -%}
                                                        {%- if results.tags contains tag -%} 
                                                            <li class="list-menu__item facets__item {{ valid_loop_index }} {% if valid_loop_index > section.settings.max_item_per_filter and section.settings.filter_display_type == 'show-more' %}d-none{% endif %}{% if filter_swatch contains label %} facets__item--swatch{% elsif filter_rectangle contains label %} facets__item--rectangle{% endif %}">
                                                                <input
                                                                    type="checkbox"
                                                                    value="{{ value | split: '|' | first }}"
                                                                    name="Filter-{{ label | escape }}-{{ forloop.index }}"
                                                                    id="Filter-{{ label | escape }}-{{ forloop.index }}"
                                                                >
                                                                {%- if filter_swatch contains label -%}
                                                                    <label
                                                                        for="Filter-{{ label | escape }}-{{ forloop.index }}"
                                                                        class="facet-checkbox"
                                                                        title="{{ item }}"
                                                                    >
                                                                        <span class="pattern{% if value.value == 'white' or value.value == 'White' %} pattern--white{% endif %}" 
                                                                        style="background-color: {{ value.value | split: ' ' | last | handle }};
                                                                                {%- if filter_swatch_type == 'png' and variant.image %}
                                                                                background-image: url({{ variant.image.src | product_img_url: '40x'}});
                                                                                {% else %}
                                                                                background-image: url({{ value.value | strip | handleize | handle | append: '.' | append: file_extension | file_url }})
                                                                                {% endif %}">
                                                                        </span>
                                                                    </label>
                                                                {%- elsif filter_rectangle contains label -%}
                                                                    <label
                                                                        for="Filter-{{ label | escape }}-{{ forloop.index }}"
                                                                        class="facet-checkbox"
                                                                        title="{{ item }}"
                                                                    >
                                                                        <span class="text">{{ item | split: '|' | first }}</span>
                                                                    </label>
                                                                {%- else -%}
                                                                    <label
                                                                        for="Filter-{{ label | escape }}-{{ forloop.index }}"
                                                                        class="facet-checkbox form-label--checkbox"
                                                                        title="{{ item }}"
                                                                    >
                                                                        {{ item | split: '|' | first }}
                                                                    </label>
                                                                {%- endif -%}
                                                            </li>
                                                        {% else %}
                                                            {% assign loop_back = loop_back | plus: 1 %}
                                                        {%- endif -%}
                                                    {%- endif -%}
                                                {%- endfor -%}
                                            </ul>
                                            <a href="javascript:void(0)" class="facets__reset link link-underline" {% if count == 0 %} style="display: none;"{% endif %} data-clear-filter>
                                                <span class="text">{{ 'sections.collection_template.clear_all' | t }}</span>
                                            </a>
                                        </div>
                                    {%- if show_collapse -%}
                                        </div>
                                    {%- endif -%}
                                    {% assign valid_tags_size = tags.size | minus: loop_back %}
                                    {% if section.settings.filter_display_type == 'show-more' %}
                                        {% if valid_tags_size > section.settings.max_item_per_filter %}
                                            <div class="show-more--list_tags" data-show-more-btn="{{ label | downcase }}">
                                                <span class="icon-container">
                                                    {% render 'icon-show-more' %}
                                                </span>
                                                <span class="btn-text">
                                                    <span data-show-more-content>{{ 'sections.collection_template.show_all' | t }}</span>
                                                </span>
                                            </div>
                                        {% endif %}
                                    {% endif %} 
                                </div>
                            {%- endif -%}
                        {%- endfor -%}
                        <noscript>
                            <button type="submit" class="facets__button button">
                                {{ 'sections.collection_template.filter_button' | t }}
                            </button>
                        </noscript>
                    </div>
                </form>
            </collection-filters-form>
        {%- endif -%}
    </div>
{%- endif -%}
{%- if sidebar_type == 'vertical' -%}
    {%- for block in section.blocks -%}
        {%- if block.type == 'recent_post' -%}
            {% render 'halo-side-recent-post',
                block: block,
                show_collapse: show_collapse,
                sidebar_collapse: sidebar_collapse
            %}
        {%- elsif block.type == 'recent_tag' -%}
            {% render 'halo-side-recent-tag',
                block: block,
                show_collapse: show_collapse,
                sidebar_collapse: sidebar_collapse
            %}
        {%- elsif block.type == 'product_block' -%}
            {% assign position = block.settings.position %}
            {% if position != 'content' %}
                {% render 'halo-side-product-block',
                    block: block,
                    show_collapse: show_collapse,
                    sidebar_collapse: sidebar_collapse,
                    position: position
                %}
            {% endif %}
        {%- elsif block.type == 'image' -%}
            {% render 'halo-side-image',
                block: block,
                show_collapse: show_collapse,
                sidebar_collapse: sidebar_collapse
            %}
        {%- elsif block.type == 'text' -%}
            {% render 'halo-side-custom-text',
                block: block,
                show_collapse: show_collapse,
                sidebar_collapse: sidebar_collapse
            %}
        {%- endif -%}
    {%- endfor -%}
{%- endif -%}
{%- if show_filter -%}
    {%- if filter_type == 'storefront' -%}
        <script src="{{ 'collection-filters-form.js' | asset_url }}" defer="defer"></script>
    {%- else -%}
        <script src="{{ 'collection-filter-by-tag-form.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}
{%- endif -%}